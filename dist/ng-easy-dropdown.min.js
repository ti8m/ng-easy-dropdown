!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("angular")):"function"==typeof define&&define.amd?define("ngEasyDropdown",["angular"],t):t(e.angular)}(this,function(e){"use strict";function t(e){for(var t=0,n=e;n.previousElementSibling;)t+=1,n=n.previousElementSibling;return t}function n(e){return Array.prototype.filter.call(e.parentNode.children,function(t){return t!==e})}function o(e){var t=e.parentNode,n=e.parentNode.parentNode;return n.insertBefore(e,t),n.removeChild(t),e}function i(e){return e.replace(/.*\sin\s([^ ]+).*/,"$1")}function s(e){return{restrict:"A",controller:"easyDropdownController",require:["easyDropdown","?ngModel"],scope:{settings:"<"},link:function(n,o,s,r){function c(){h.init(o,n.settings||{})}function a(t){e(function(){t.match(/\[.*\]/)?c():n.$watchCollection(function(){return n.$parent[t]},function(){e(function(){h.rendered&&h.destroy(),c()})},!0)})}var u=l(r,2),h=u[0],d=u[1];s.ngOptions&&a(i(s.ngOptions)),e(function(){var e=[].slice.call(o.find("option")),t=e.find(function(e){return e.hasAttribute("ng-repeat")});t?a(i(t.getAttribute("ng-repeat"))):c()}),d&&n.$watch(function(){return d.$modelValue},function(n){n&&h.rendered&&e(function(){var e=o[0].querySelector("[selected]");if(e){var n=t(e);h.select(n)}})})}}}e="default"in e?e.default:e,Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length-1;n>=0;n-=1)if(t.item(n)===this)return!0;return!1}),window.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var t=(this.document||this.ownerDocument).querySelectorAll(e),n=void 0,o=this;do{for(n=t.length;--n>=0&&t.item(n)!==o;);}while(n<0&&(o=o.parentElement));return o}),function(e){e.forEach(function(e){e.hasOwnProperty("previousElementSibling")||Object.defineProperty(e,"previousElementSibling",{configurable:!0,enumerable:!0,get:function(){for(var e=this;e=e.previousSibling;)if(1===e.nodeType)return e;return null},set:void 0})})}([Element.prototype,CharacterData.prototype]),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t=Object(this),n=t.length>>>0,o=arguments[1],i=void 0,s=0;s<n;s++)if(i=t[s],e.call(o,i,s,t))return i});var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=function(){function e(e,t){var n=[],o=!0,i=!1,s=void 0;try{for(var r,c=e[Symbol.iterator]();!(o=(r=c.next()).done)&&(n.push(r.value),!t||n.length!==t);o=!0);}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=e.element,u=function(){function i(e,t){r(this,i),this.$window=e,this.$rootScope=t,this.isField=!0,this.down=!1,this.inFocus=!1,this.disabled=!1,this.cutOff=!1,this.hasLabel=!1,this.keyboardMode=!1,this.nativeTouch=!0,this.wrapperClass="dropdown",this.onChange=null,this.instances={}}return c(i,[{key:"init",value:function(t,n){var o=this;e.extend(this,n),this.$select=t,this.options=[],this.$options=this.$select.find("option"),this.isTouch="ontouchend"in this.$window.document,this.$select.removeClass(this.wrapperClass+" dropdown"),this.$select[0].matches(":disabled")&&(this.disabled=!0),this.$options.length&&(window.o=this.$options,e.forEach(this.$options,function(e,t){e.matches(":checked")&&(o.selected={index:t,title:e.innerText},o.focusIndex=t),e.matches(".label")&&0===t?(o.hasLabel=!0,o.label=e.innerText,e.setAttribute("value","")):o.options.push({domNode:e,title:e.innerText,value:e.value,selected:e.matches(":checked")})}),this.selected||(this.selected={index:0,title:this.$options.eq(0).text()},this.focusIndex=0),this.render()),this.$rootScope.$on("easyDropdown:closeAll",this.close.bind(this))}},{key:"render",value:function(){var e=this,t=this.isTouch&&this.nativeTouch?" touch":"",n=this.disabled?" disabled":"";this.$container=this.$select.wrap('<div class="'+this.wrapperClass+t+n+'"></div>').wrap('<span class="old">').parent().parent(),this.$active=a('<span class="selected">'+this.selected.title+"</span>"),this.$container.append(this.$active),this.$carat=a('<span class="carat"/>'),this.$container.append(this.$carat),this.$scrollWrapper=a("<div><ul/></div>"),this.$container.append(this.$scrollWrapper),this.$dropDown=this.$scrollWrapper.find("ul"),this.$form=a(this.$container[0].closest("form")),this.options.forEach(function(t){var n=t.selected?' class="active"':"";e.$dropDown.append("<li"+n+">"+t.title+"</li>")}),this.$items=this.$dropDown.find("li"),this.cutOff&&this.$items.length>this.cutOff&&this.$container.addClass("scrollable"),this.getMaxHeight(),this.isTouch&&this.nativeTouch?this.bindTouchHandlers():this.bindHandlers(),this.rendered=!0}},{key:"getMaxHeight",value:function(){this.maxHeight=0;for(var e=0;e<this.$items.length;e+=1){var t=this.$items.eq(e);if(this.maxHeight+=t[0].offsetHeight,this.cutOff===e+1)break}}},{key:"bindTouchHandlers",value:function(){var e=this;this.$container.on("click",function(){e.$select[0].focus()}),this.$select.on("change",function(t){var n=t.target.querySelectorAll("option:checked")[0],o=n.innerText,i=n.value;e.$active.text(o),"function"==typeof e.onChange&&e.onChange.call(e.$select[0],{title:o,value:i})}),this.$select.on("focus",function(){e.$container.addClass("focus")}),this.$select.on("focus",function(){e.$container.removeClass("focus")})}},{key:"bindHandlers",value:function(){var e=this,o=this;this.query="",this.$container.on("click",function(t){e.down||e.disabled?e.close():e.open(),t.stopPropagation()}),this.$container.on("mousemove",function(){e.keyboardMode&&(e.keyboardMode=!1)}),a(this.$window.document.body).on("click",function(t){var n=e.wrapperClass.split(" ").join(".");!t.target.closest("."+n)&&e.down&&e.close()}),this.$items.on("click",function(n){var o=t(n.target);e.select(o),e.$select[0].focus(),n.target.setAttribute("selected","selected")}),this.$items.on("mouseover",function(o){if(!e.keyboardMode){var i=a(o.target);i.addClass("focus"),n(i[0]).forEach(function(e){return a(e).removeClass("focus")}),e.focusIndex=t(o.target)}}),this.$items.on("mouseout",function(t){e.keyboardMode||a(t.target).removeClass("focus")}),this.$select.on("focus",function(){e.$container.addClass("focus"),e.inFocus=!0}),this.$select.on("blur",function(){e.$container.removeClass("focus"),e.inFocus=!1}),this.$select.on("keydown",function(t){if(e.inFocus){e.keyboardMode=!0;var n=t.keyCode,o=e.down;if(38!==n&&40!==n&&32!==n&&13!==n||(t.preventDefault(),38===n?(e.focusIndex-=1,e.focusIndex=e.focusIndex<0?e.$items.length-1:e.focusIndex):40===n&&(e.focusIndex+=1,e.focusIndex=e.focusIndex>e.$items.length-1?0:e.focusIndex),e.down||38===n||40===n?e.select(e.focusIndex):e.open(),e.$items.removeClass("focus").eq(e.focusIndex).addClass("focus"),e.cutOff&&e.scrollToView(),e.query=""),e.down)if(9===n||27===n)e.close();else{if(13===n&&o)return t.preventDefault(),e.select(e.focusIndex),e.close(),!1;if(8===n)return t.preventDefault(),e.query=e.query.slice(0,-1),e.search(),clearTimeout(e.resetQuery),!1;38!==n&&40!==n&&(e.query+=String.fromCharCode(n),e.search(),clearTimeout(e.resetQuery))}}return!0}),this.$select.on("keyup",function(){e.resetQuery=setTimeout(function(){e.query=""},1200)}),this.$dropDown.on("scroll",function(){e.$dropDown[0].scrollTop>=e.$dropDown[0].scrollHeight-e.maxHeight?e.$container.addClass("bottom"):e.$container.removeClass("bottom")}),this.$form.length&&this.$form.on("reset",function(){var t=e.hasLabel?e.label:o.options[0].title;e.$active.text(t)})}},{key:"unbindHandlers",value:function(){this.$container.off("click"),this.$container.off("mousemove"),a(this.$window.document.body).off("click"),this.$items.off("click"),this.$items.off("mouseover"),this.$items.off("mouseout"),this.$select.off("focus"),this.$select.off("blur"),this.$select.off("keydown"),this.$select.off("keyup"),this.$dropDown.off("scroll"),this.$form.off("reset")}},{key:"open",value:function(){var e=this.$window.scrollY||this.$window.document.documentElement.scrollTop,t=this.$window.scrollX||this.$window.document.documentElement.scrollLeft,n=this.notInViewport(e);this.closeAll(),this.getMaxHeight(),this.$select[0].focus(),this.$window.scrollTo(t,e+n),this.$container.addClass("open"),this.$scrollWrapper.css("height",this.maxHeight+"px"),this.down=!0}},{key:"close",value:function(){this.$container.removeClass("open"),this.$scrollWrapper.css("height","0px"),this.focusIndex=this.selected.index,this.query="",this.down=!1}},{key:"closeAll",value:function(){this.$rootScope.$emit("easyDropdown:closeAll")}},{key:"select",value:function(e){var t=this.options[e],n=this.hasLabel?e+1:e;this.$items.removeClass("active").eq(e).addClass("active"),this.$active.text(t.title),this.$select.find("option").removeAttr("selected").eq(n).prop("selected",!0).parent().triggerHandler("change"),this.selected={index:e,title:t.title},this.focusIndex=e,"function"==typeof this.onChange&&this.onChange.call(this.$select[0],{title:t.title,value:t.value})}},{key:"search",value:function(){for(var e=this,t=function(t){e.focusIndex=t,e.$items.removeClass("focus").eq(e.focusIndex).addClass("focus"),e.scrollToView()},n=function(t){return e.options[t].title.toUpperCase()},o=0;o<this.options.length;o+=1){if(0===n(o).indexOf(this.query))return void t(o)}for(var i=0;i<this.options.length;i+=1){if(n(i).indexOf(this.query)>-1){t(i);break}}}},{key:"scrollToView",value:function(){if(this.focusIndex>=this.cutOff){var e=this.$items.eq(this.focusIndex);this.$dropDown[0].scrollTop=e[0].offsetHeight*(this.focusIndex+1)-this.maxHeight}}},{key:"notInViewport",value:function(e){var t={min:e,max:e+(this.$window.innerHeight||this.$window.document.documentElement.clientHeight)},n=this.$dropDown[0].getBoundingClientRect().top+document.body.scrollTop+this.maxHeight;return n>=t.min&&n<=t.max?0:n-t.max+5}},{key:"destroy",value:function(){this.unbindHandlers(),o(this.$select[0]),n(this.$select[0]).forEach(function(e){return e.remove()}),o(this.$select[0]),this.rendered=!1}},{key:"disable",value:function(){this.disabled=!0,this.$container.addClass("disabled"),this.$select.attr("disabled",!0),this.down||this.close()}},{key:"enable",value:function(){var e=this;e.disabled=!1,e.$container.removeClass("disabled"),e.$select.attr("disabled",!1)}}]),i}();u.$inject=["$window","$rootScope"],s.$inject=["$timeout"],e.module("ng-easy-dropdown",[]).directive("easyDropdown",s).controller("easyDropdownController",u)});
//# sourceMappingURL=ng-easy-dropdown.min.js.map
