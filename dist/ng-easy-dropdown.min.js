!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("angular")):"function"==typeof define&&define.amd?define("ngEasyDropdown",["angular"],t):t(e.angular)}(this,function(e){"use strict";function t(e){for(var t=0,o=e;o.previousElementSibling;)t+=1,o=o.previousElementSibling;return t}function o(e){return Array.prototype.filter.call(e.parentNode.children,function(t){return t!==e})}function n(e){var t=e.parentNode,o=e.parentNode.parentNode;return o.insertBefore(e,t),o.removeChild(t),e}function i(e){return e.replace(/.*\sin\s([^ ]+).*/,"$1")}function s(e){return{restrict:"A",controller:"easyDropdownController",require:["easyDropdown","?ngModel"],scope:{settings:"<"},link:function(o,n,s,r){function c(){h.init(n,o.settings||{})}function a(t){e(function(){t.match(/\[.*\]/)?c():o.$watchCollection(function(){return o.$parent[t]},function(){e(function(){h.rendered&&h.destroy(),c()})},!0)})}var u=l(r,2),h=u[0],d=u[1];s.ngOptions&&a(i(s.ngOptions)),e(function(){var e=[].slice.call(n.find("option")),t=e.find(function(e){return e.hasAttribute("ng-repeat")});t?a(i(t.getAttribute("ng-repeat"))):c()}),d&&o.$watch(function(){return d.$modelValue},function(o){o&&h.rendered&&e(function(){var e=n[0].querySelector("[selected]");if(e){var o=t(e);h.select(o)}})})}}}e="default"in e?e.default:e,Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),o=t.length-1;o>=0;o-=1)if(t.item(o)===this)return!0;return!1}),window.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var t=(this.document||this.ownerDocument).querySelectorAll(e),o=void 0,n=this;do{for(o=t.length;--o>=0&&t.item(o)!==n;);}while(o<0&&(n=n.parentElement));return n}),function(e){e.forEach(function(e){e.hasOwnProperty("previousElementSibling")||Object.defineProperty(e,"previousElementSibling",{configurable:!0,enumerable:!0,get:function(){for(var e=this;e=e.previousSibling;)if(1===e.nodeType)return e;return null},set:void 0})})}([Element.prototype,CharacterData.prototype]),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t=Object(this),o=t.length>>>0,n=arguments[1],i=void 0,s=0;s<o;s++)if(i=t[s],e.call(n,i,s,t))return i});var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),l=function(){function e(e,t){var o=[],n=!0,i=!1,s=void 0;try{for(var r,c=e[Symbol.iterator]();!(n=(r=c.next()).done)&&(o.push(r.value),!t||o.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{!n&&c.return&&c.return()}finally{if(i)throw s}}return o}return function(t,o){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=e.element,u=function(){function i(e,t){r(this,i),this.$window=e,this.$rootScope=t,this.isField=!0,this.down=!1,this.inFocus=!1,this.disabled=!1,this.cutOff=!1,this.hasLabel=!1,this.keyboardMode=!1,this.nativeTouch=!0,this.wrapperClass="dropdown",this.onChange=null,this.instances={}}return c(i,[{key:"init",value:function(t,o){var n=this;e.extend(this,o),this.$select=t,this.options=[],this.$options=this.$select.find("option"),this.isTouch="ontouchend"in this.$window.document,this.$select.removeClass(this.wrapperClass+" dropdown"),this.$select[0].matches(":disabled")&&(this.disabled=!0),this.$options.length&&(window.o=this.$options,e.forEach(this.$options,function(e,t){e.matches(":checked")&&(n.selected={index:t,title:e.innerText},n.focusIndex=t),e.matches(".label")&&0===t?(n.hasLabel=!0,n.label=e.innerText,e.setAttribute("value","")):n.options.push({domNode:e,title:e.innerText,value:e.value,selected:e.matches(":checked")})}),this.selected||(this.selected={index:0,title:this.$options.eq(0).text()},this.focusIndex=0),this.render()),this.$rootScope.$on("easyDropdown:closeAll",this.close.bind(this))}},{key:"render",value:function(){var e=this,t=this.isTouch&&this.nativeTouch?" touch":"",o=this.disabled?" disabled":"";this.$container=this.$select.wrap('<div class="'+this.wrapperClass+t+o+'"></div>').wrap('<span class="old">').parent().parent(),this.$active=a('<span class="selected">'+this.selected.title+"</span>"),this.$container.append(this.$active),this.$carat=a('<span class="carat"/>'),this.$container.append(this.$carat),this.$scrollWrapper=a("<div><ul/></div>"),this.$container.append(this.$scrollWrapper),this.$dropDown=this.$scrollWrapper.find("ul"),this.$form=a(this.$container[0].closest("form")),this.options.forEach(function(t){var o=t.selected?' class="active"':"";e.$dropDown.append("<li"+o+">"+t.title+"</li>")}),this.$items=this.$dropDown.find("li"),this.cutOff&&this.$items.length>this.cutOff&&this.$container.addClass("scrollable"),this.getMaxHeight(),this.isTouch&&this.nativeTouch?this.bindTouchHandlers():this.bindHandlers(),this.rendered=!0}},{key:"getMaxHeight",value:function(){this.maxHeight=0;for(var e=0;e<this.$items.length;e+=1){var t=this.$items.eq(e);if(this.maxHeight+=t[0].offsetHeight,this.cutOff===e+1)break}}},{key:"bindTouchHandlers",value:function(){var e=this;this.$container.on("click",function(){e.$select[0].focus()}),this.$select.on("change",function(t){var o=t.target.querySelectorAll("option:checked")[0],n=o.innerText,i=o.value;e.$active.text(n),"function"==typeof e.onChange&&e.onChange.call(e.$select[0],{title:n,value:i})}),this.$select.on("focus",function(){e.$container.addClass("focus")}),this.$select.on("focus",function(){e.$container.removeClass("focus")})}},{key:"bindHandlers",value:function(){var e=this,n=this;this.query="",this.$container.on("click",function(t){e.down||e.disabled?e.close():e.open(),t.stopPropagation()}),this.$container.on("mousemove",function(){e.keyboardMode&&(e.keyboardMode=!1)}),a(this.$window.document.body).on("click",function(t){var o=e.wrapperClass.split(" ").join(".");!t.target.closest("."+o)&&e.down&&e.close()}),this.$items.on("click",function(o){var n=t(o.target);e.select(n),e.$select[0].focus(),o.target.setAttribute("selected","selected")}),this.$items.on("mouseover",function(n){if(!e.keyboardMode){var i=a(n.target);i.addClass("focus"),o(i[0]).forEach(function(e){return a(e).removeClass("focus")}),e.focusIndex=t(n.target)}}),this.$items.on("mouseout",function(t){e.keyboardMode||a(t.target).removeClass("focus")}),this.$select.on("focus",function(){e.$container.addClass("focus"),e.inFocus=!0}),this.$select.on("blur",function(){e.$container.removeClass("focus"),e.inFocus=!1}),this.$select.on("keydown",function(t){if(e.inFocus){e.keyboardMode=!0;var o=t.keyCode;console.log("key",o);var n=e.down;if(38!==o&&40!==o&&32!==o&&13!==o||(t.preventDefault(),38===o?(e.focusIndex-=1,e.focusIndex=e.focusIndex<0?e.$items.length-1:e.focusIndex):40===o&&(e.focusIndex+=1,e.focusIndex=e.focusIndex>e.$items.length-1?0:e.focusIndex),e.down||38===o||40===o?e.select(e.focusIndex):e.open(),e.$items.removeClass("focus").eq(e.focusIndex).addClass("focus"),e.cutOff&&e.scrollToView(),e.query=""),e.down)if(16===o)e.shift=!0;else if(9===o||27===o)e.close();else{if(13===o&&n)return t.preventDefault(),e.select(e.focusIndex),e.close(),!1;if(8===o)return t.preventDefault(),e.query=e.query.slice(0,-1),e.search(),clearTimeout(e.resetQuery),!1;16!==o&&38!==o&&40!==o&&(e.query+=e.shift?String.fromCharCode(o):String.fromCharCode(o).toLowerCase(),e.search(),clearTimeout(e.resetQuery))}}return console.log(e.query),!0}),this.$select.on("keyup",function(t){16===t.keyCode&&(e.shift=!1),e.resetQuery=setTimeout(function(){e.query=""},1200)}),this.$dropDown.on("scroll",function(){e.$dropDown[0].scrollTop>=e.$dropDown[0].scrollHeight-e.maxHeight?e.$container.addClass("bottom"):e.$container.removeClass("bottom")}),this.$form.length&&this.$form.on("reset",function(){var t=e.hasLabel?e.label:n.options[0].title;e.$active.text(t)})}},{key:"unbindHandlers",value:function(){this.$container.off("click"),this.$container.off("mousemove"),a(this.$window.document.body).off("click"),this.$items.off("click"),this.$items.off("mouseover"),this.$items.off("mouseout"),this.$select.off("focus"),this.$select.off("blur"),this.$select.off("keydown"),this.$select.off("keyup"),this.$dropDown.off("scroll"),this.$form.off("reset")}},{key:"open",value:function(){var e=this.$window.scrollY||this.$window.document.documentElement.scrollTop,t=this.$window.scrollX||this.$window.document.documentElement.scrollLeft,o=this.notInViewport(e);this.closeAll(),this.getMaxHeight(),this.$select[0].focus(),this.$window.scrollTo(t,e+o),this.$container.addClass("open"),this.$scrollWrapper.css("height",this.maxHeight+"px"),this.down=!0}},{key:"close",value:function(){this.$container.removeClass("open"),this.$scrollWrapper.css("height","0px"),this.focusIndex=this.selected.index,this.query="",this.down=!1}},{key:"closeAll",value:function(){this.$rootScope.$emit("easyDropdown:closeAll")}},{key:"select",value:function(e){var t=this.options[e],o=this.hasLabel?e+1:e;this.$items.removeClass("active").eq(e).addClass("active"),this.$active.text(t.title),this.$select.find("option").removeAttr("selected").eq(o).prop("selected",!0).parent().triggerHandler("change"),this.selected={index:e,title:t.title},this.focusIndex=e,"function"==typeof this.onChange&&this.onChange.call(this.$select[0],{title:t.title,value:t.value})}},{key:"search",value:function(){for(var e=this,t=function(t){e.focusIndex=t,e.$items.removeClass("focus").eq(e.focusIndex).addClass("focus"),e.scrollToView()},o=function(t){return e.options[t].title},n=0;n<this.options.length;n+=1){var i=o(n),s=o(n).toLowerCase();if(0===i.indexOf(this.query))return void t(n);0===s.indexOf(this.query.toLowerCase())&&t(n)}for(var r=0;r<this.options.length;r+=1){if(o(r).indexOf(this.query)>-1){t(r);break}}}},{key:"scrollToView",value:function(){if(this.focusIndex>=this.cutOff){var e=this.$items.eq(this.focusIndex);this.$dropDown[0].scrollTop=e[0].offsetHeight*(this.focusIndex+1)-this.maxHeight}}},{key:"notInViewport",value:function(e){var t={min:e,max:e+(this.$window.innerHeight||this.$window.document.documentElement.clientHeight)},o=this.$dropDown[0].getBoundingClientRect().top+document.body.scrollTop+this.maxHeight;return o>=t.min&&o<=t.max?0:o-t.max+5}},{key:"destroy",value:function(){this.unbindHandlers(),n(this.$select[0]),o(this.$select[0]).forEach(function(e){return e.remove()}),n(this.$select[0]),this.rendered=!1}},{key:"disable",value:function(){this.disabled=!0,this.$container.addClass("disabled"),this.$select.attr("disabled",!0),this.down||this.close()}},{key:"enable",value:function(){var e=this;e.disabled=!1,e.$container.removeClass("disabled"),e.$select.attr("disabled",!1)}}]),i}();u.$inject=["$window","$rootScope"],s.$inject=["$timeout"],e.module("ng-easy-dropdown",[]).directive("easyDropdown",s).controller("easyDropdownController",u)});
//# sourceMappingURL=ng-easy-dropdown.min.js.map
